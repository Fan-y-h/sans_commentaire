<script>
  const noButton = document.getElementById("no");
  const yesButton = document.getElementById("yes");
  const container = document.getElementById("container");
  const hint = document.getElementById("hint");
  
  let escapeCount = 0;
  let scale = 1;
  let fleeing = false;
  let safeZone = false;

  function isOverlapping(x, y) {
    const noW = noButton.offsetWidth * scale;
    const noH = noButton.offsetHeight * scale;
    const noRect = {
      left: x,
      right: x + noW,
      top: y,
      bottom: y + noH
    };
    const yesRect = yesButton.getBoundingClientRect();
    const containerRect = container.getBoundingClientRect();
    const yes = {
      left: yesRect.left - containerRect.left,
      right: yesRect.right - containerRect.left,
      top: yesRect.top - containerRect.top,
      bottom: yesRect.bottom - containerRect.top
    };
    return !(
      noRect.right < yes.left ||
      noRect.left > yes.right ||
      noRect.bottom < yes.top ||
      noRect.top > yes.bottom
    );
  }

  function moveButton(e) {
    if (e.type === 'touchstart') {
      e.preventDefault();
    }
    
    escapeCount++;
    
    // AprÃ¨s 20 tentatives : zone de sÃ©curitÃ© en bas Ã  droite
    if (escapeCount === 20) {
      safeZone = true;
      hint.textContent = "ðŸ’¡ Indice : cherche dans le coin en bas Ã  droite...";
      
      // Positionner dans le coin
      const maxX = container.clientWidth - noButton.offsetWidth * scale;
      const maxY = container.clientHeight - noButton.offsetHeight * scale;
      
      if (!fleeing) {
        fleeing = true;
        noButton.classList.add("flee");
      }
      
      noButton.style.left = (maxX - 20) + "px";
      noButton.style.top = (maxY - 20) + "px";
      return;
    }
    
    // En zone de sÃ©curitÃ©, ne plus bouger
    if (safeZone) return;
    
    if (!fleeing) {
      fleeing = true;
      noButton.classList.add("flee");
    }

    if (escapeCount >= 5) {
      scale = Math.max(0.5, scale - 0.08);
      noButton.style.transform = `scale(${scale})`;
    }

    const maxX = container.clientWidth - noButton.offsetWidth * scale;
    const maxY = container.clientHeight - noButton.offsetHeight * scale;
    let x, y, tries = 0;
    
    do {
      x = Math.random() * maxX;
      y = Math.random() * maxY;
      tries++;
    } while (isOverlapping(x, y) && tries < 100);

    noButton.style.left = x + "px";
    noButton.style.top = y + "px";
  }

  noButton.addEventListener("mouseenter", moveButton);
  noButton.addEventListener("touchstart", moveButton, { passive: false });

  yesButton.addEventListener("click", () => {
    window.location.href = "evidement.html";
  });

  noButton.addEventListener("click", (e) => {
    if (!safeZone) {
      e.preventDefault();
    } else {
      window.location.href = "Certes.html";
    }
  });
</script>
